From: <Saved by Blink>
Snapshot-Content-Location: http://johnbokma.com/blog/2016/09/02/migrating-paralles-vm-to-virtualbox.html
Subject: Migrating a Parallels Virtual Machine to VirtualBox - John Bokma
Date: Thu, 21 Mar 2019 11:23:19 -0000
MIME-Version: 1.0
Content-Type: multipart/related;
	type="text/html";
	boundary="----MultipartBoundary--iaYFYzxq7CY6PurxT9wnbPaGOyp84KrhGc9pyzJE2N----"


------MultipartBoundary--iaYFYzxq7CY6PurxT9wnbPaGOyp84KrhGc9pyzJE2N----
Content-Type: text/html
Content-ID: <frame-0E339CE5AB9CE05A18034CB167D68072@mhtml.blink>
Content-Transfer-Encoding: quoted-printable
Content-Location: http://johnbokma.com/blog/2016/09/02/migrating-paralles-vm-to-virtualbox.html

<!DOCTYPE html><html><head><meta http-equiv=3D"Content-Type" content=3D"tex=
t/html; charset=3DUTF-8">
 =20
  <title>Migrating a Parallels Virtual Machine to VirtualBox - John Bokma</=
title>
  <link rel=3D"stylesheet" href=3D"http://johnbokma.com/style5.css">
</head>
<body>
  <div id=3D"topad">
     I am a senior Perl programmer for hire; download my
     <a href=3D"http://castleamber.com/documents/perl-programmer-john-bokma=
-resume.pdf">resume as PDF</a>
  </div>
  <div id=3D"page">
    <div id=3D"top">
      <div id=3D"site">
        John Bokma's Hacking &amp; Hiking
      </div>
      <div id=3D"topnav">
        <ul>
          <li><a href=3D"http://johnbokma.com/">home</a></li>
          <li><a href=3D"http://johnbokma.com/blog/">blog</a></li>
        </ul>
      </div>
    </div>
    <div id=3D"article">
      <h1>Migrating a Parallels Virtual Machine to VirtualBox</h1>
<p>September 2, 2016</p>
<p>The 31st of August I removed Parallels Tools from a virtual machine
running Ubuntu 15.10 because the grace period of 7 days, so
"generously" given by Parallels after I didn't renew my subscription,
had ended. Somehow this company considers it a smart move to make
their
<a href=3D"http://johnbokma.com/blog/2016/08/26/when-software-subscriptions=
-really-suck.html">software useless if one no longer pays</a>. I
understand removing some functionality, like for example no longer
able to create new virtual machines, but this? No, too close to
ransomware for my taste. Especially since Parallels Desktop needs to
be updated often, either to deal with changes in the host operating
system, OS X, or changes in the guest operating systems.</p>
<p>Anyway, to be honest, it was always my plan to eventually move my
work, as a freelance Perl programmer to OS X. One of the reasons I
bought a Mac mini. However, I was expecting the move to be a bit more
on my terms, less forced. To make the transition more gradual, I
decided to move the Ubuntu 15.10 virtual machine to VirtualBox.</p>
<h2>Uninstalling Parallels Tools</h2>
<p>To run things smoother Parallels Desktop can make modifications to a
guest operating system installed in a virtual machine. Because I was
afraid these modifications are going to conflict with VirtualBox after
the migration, I uninstalled Parallels Tools.</p>
<p>Wednesday, I tried the first solution given at
<a href=3D"http://kb.parallels.com/117044">How to uninstall Parallels Tools=
 in Ubuntu Linux</a>,
which didn't work for me. Luckily there was alternative given, an
easier one in my opinion, running just one command:</p>
<pre><code>sudo /usr/lib/parallels-tools/install -r
</code></pre>
<p>And this did the trick.</p>
<p>Since it was already late I decided to do the rest of the required
move the coming days.</p>
<h2>Uninstalling an old version of VirtualBox</h2>
<p>While writing this all down I noticed that I had already an older
version of VirtualBox installed on my Mac mini, version 5.0.16 r105871
to be exact. Instead of just updating it I decided to uninstall
it. But first I removed a bunch of virtual machines which I no longer
needed; I was no longer working on the project requiring those. This
freed up quite some harddisk space on my Mac.</p>
<p>In the end I kept three VMs; <code>sparkvm</code> which I used during tw=
o
<a href=3D"https://www.edx.org/">edX</a> courses, Windows XP with SP3, and
Ubuntu 15.10. The later was my go to VM when Parallels Desktop had a
major issue with a Compiz update. I actually wanted to decommision
that one by comparing files to a recent backup, but it won't let me
mount an external USB drive. I got an error dialog with the following
message.</p>
<blockquote>
<p>Failed to attach the USB device
<strong>Western Digital My Passport 0820</strong>
<strong>[1007]</strong> to the virtual machine <strong>Ecce</strong>
<strong>15.10</strong></p>
</blockquote>
<p>When I clicked details I read:</p>
<blockquote>
<p>Failed to create a proxy device for the USB
device. (Error: VERR_PDM_NO_USB_PORTS).</p>
</blockquote>
<p>Followed by some more technical details regarding the issue. Hopefully
this is fixed in the version I am about to install as I really need to
be able to access external USB devices, especially hard disks.</p>
<p>Edit: enabling "USB 3.0 (xHCI) Controller" in the settings most likely
fixes this issue, see below, near the end of this blog post.</p>
<p>I exported each virtual machine to a file using the "Export
Appliance..." option in the File menu of VirtualBox. Next, I deleted
each virtual machine. Since I use Time Machine I am not too worried if
the export of the virtual machines fails at one point; rolling back is easy=
.</p>
<p>Next, I uninstalled VirtualBox not by just deleting the program from
the Applications folder but by actually running the uninstaller which
came with it in the file I had downloaded months ago;
<code>VirtualBox-5.0.16-105871-OSX.dmg</code>. The reason for this is that
VirtualBox installs several kernel extensions (kexts), which are not
deleted by just removing the app from the Applications
directory. Those kexts can be listed as follows:</p>
<pre><code>kextstat -l |
    perl -n -e '/\s(org\.virtualbox\..+?)\s\((\S+)\)/ &amp;&amp; print "$1 =
$2\n"'

org.virtualbox.kext.VBoxDrv 5.0.16
org.virtualbox.kext.VBoxUSB 5.0.16
org.virtualbox.kext.VBoxNetFlt 5.0.16
org.virtualbox.kext.VBoxNetAdp 5.0.16
</code></pre>
<p>The Perl one liner is used to print just the name and version number
of only the <code>org.virtualbox</code> kexts.</p>
<p>So after I had removed (deleted) the three remaining virtual machines
and quit VirtualBox I ran the DMG and selected
<code>VirtualBox_Uninstall.tool</code>. After confirming that I was sure to=
 open
the script a terminal window was opened in which I had to confirm the
uninstall by typing "yes". Next the process prompted me for a password
to grant it administrative privileges.</p>
<p>After the script reported <code>[Process completed]</code> I closed the
window. When I ran the above <code>kextstat</code> pipe again, no lines sho=
wed
up; the kernel extensions had been unloaded.</p>
<h2>Downloading and Installing VirtualBox 5.1</h2>
<p>I downloaded VirtualBox 5.1.4 for OS X via the official
<a href=3D"https://www.virtualbox.org/wiki/Downloads">VirtualBox download p=
age</a>.
When I opened the downloaded DMG a dialog showed up. I followed the
installation instructions given and double clicked the
<code>VirtualBox.pkg</code> icon. The installer wanted to run a program to
determine if the software can be installed, so I clicked Continue, and
again in the installer dialog window itself, followed by a click on
Install. After I entered my password VirtualBox was installed.</p>
<h2>Migrating the Parallels Virtual Machine</h2>
<p>I migrated my Ubuntu 15.10 Parallels Desktop virtual machine using
<a href=3D"https://forums.virtualbox.org/viewtopic.php?p=3D272897&amp;sid=
=3Db3a902e160b12c96abaaf087e01d258c#p272897">instructions by Jummy</a>
which I have written out less concise below.</p>
<ul>
<li>
<p>Use Finder to open the Parallels directory located in Documents</p>
</li>
<li>
<p>Select the virtual machine</p>
</li>
<li>
<p>Open the context menu and select "Show Package Contents"</p>
</li>
<li>
<p>Select the file with the extension <code>hdd</code>; in my case <code>Ub=
untu Linux-0.hdd</code>.</p>
</li>
<li>
<p>Open the context menu and select "Show Package Contents"</p>
</li>
<li>
<p>Locate the file with extension <code>hds</code> and copy it to a differe=
nt
location. This is the largest file, in my case over 180GB.</p>
<p>Note that if your virtual machine is large, like in my case, it can
take quite some time to make a copy of it.</p>
</li>
<li>
<p>Open VirtualBox and click the "New" icon to create a new Virtual
Machine. In my case I used:</p>
<ul>
<li>Name: Ubuntu 15.10</li>
<li>Type: Linux</li>
<li>Version: Ubuntu (64-bit)</li>
</ul>
</li>
<li>
<p>Select the amount of memory; I used 4096 MB (4G).</p>
</li>
<li>
<p>Move the file with the <code>hds</code> extension you copied earlier int=
o the
subdirectory of <code>VirtualBox VMs</code> with the same name as given to =
the
virtual machine you're creating. The <code>VirtualBox VMs</code> directory =
is
located in your home directory. Change the extension of the file to
<code>hdd</code>.</p>
<p>I used:</p>
</li>
</ul>
<pre><code>mv ~/Ubuntu\ Linux-0.hdd.0.\{5fbaabe3-6958-40ff-92a7-860e329aab4=
1\}.hds \
   ~/VirtualBox\ VMs/Ubuntu\ 15.10/Ubuntu\ 15.10.hdd
</code></pre>
<ul>
<li>Important: in the Hard Disk step select "Use an existing virtual
hard disk file" and select the file you just moved. In my case
<code>Ubuntu 15.10.hdd</code>.</li>
<li>Click create.</li>
<li>Start the virtual machine.</li>
</ul>
<p>In my case this worked!</p>
<p>I logged in, no problem. Next I shut down the virtual machine because
I wanted to install the VirtualBox extension pack first to test USB
support, followed by installing the Guest Additions in my migrated
virtual machine.</p>
<h2>Installing the VirtualBox Extension Pack</h2>
<p>I downloaded VirtualBox 5.1.4 extension pack via the official
<a href=3D"https://www.virtualbox.org/wiki/Downloads">VirtualBox download p=
age</a>.
After the download finished I just opened the extension
pack. VirtualBox asked for confirmation and I clicked Install. Next,
I had to agree with the "VirtualBox Personal Use and Evaluation
Licence (PUEL)", which I did by clicking on the "I Agree" button. I
entered my password and nearly immediately the message that the
extension pack was installed successfully showed up.</p>
<h2>Installing Guest Additions</h2>
<p>I started the migrated virtual machine and logged in. From the
"Devices" menu I selected the bottom entry "Insert Guest Additions CD
Image...". Ubuntu asked if I wanted to run the software; I confirmed.
After I had entered my password the installation process started.</p>
<p>When the installation was done I pressed Return to close the window,
as suggested by the installer and rebooted the virtual machine. After
logging in I was not able to change the desktop resolution to anything
higher than 1024 x 768. Worse, I still could not access a USB drive.</p>
<p>To fix the latter I Googled for <code>VERR_PDM_NO_USB_PORTS</code>, a co=
de given
in the details of the error message, and found the solution. I had to
stop the virtual machine, open the settings and in the USB tab of
"Ports" enable "USB 3.0 (xHCI) Controller". After I had done this I
started the virtual machine once more. And this time I could use the
external hard disk.</p>
<p>The resolution, however, is still stuck at a maximum of 1024
x 768. It's not that important as I want to migrate the coming weeks
to OS X, and this minor nuisance might make this happen sooner than
later.</p>
    </div>
    <div id=3D"bottomnav">
      <ul>
        <li><a href=3D"http://johnbokma.com/">home</a></li>
        <li><a href=3D"http://johnbokma.com/blog/">blog</a></li>
        <li><a href=3D"http://johnbokma.com/email.html">email</a></li><a hr=
ef=3D"http://johnbokma.com/email.html">
      </a></ul><a href=3D"http://johnbokma.com/email.html">
    </a></div><a href=3D"http://johnbokma.com/email.html">
  </a></div><a href=3D"http://johnbokma.com/email.html">


</a></body></html>
------MultipartBoundary--iaYFYzxq7CY6PurxT9wnbPaGOyp84KrhGc9pyzJE2N----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: http://johnbokma.com/style5.css

@charset "utf-8";

html { box-sizing: border-box; font-size: 16px; line-height: 24px; }

*, ::before, ::after { box-sizing: inherit; }

html, body { margin: 0px; padding: 0px; border: 0px; }

body { background-color: white; font-size: 16px; line-height: 24px; font-fa=
mily: "San Fransisco", "Trebuchet MS", Verdana, Helvetica, sans-serif; }

h1 { font-size: 32px; line-height: 48px; padding-top: 20px; clear: both; }

blockquote { margin-left: 0px; padding-left: 16px; border-left: 8px solid r=
gb(238, 238, 238); }

h2 { font-size: 24px; line-height: 36px; }

#topnav { float: right; }

#topnav ul { list-style: none; margin: 0px; padding: 0px 10px; }

#topnav ul li { display: inline; padding-left: 8px; }

#site { float: left; padding: 0px; color: rgb(102, 102, 102); font-style: o=
blique; }

#top, #article, #bottomnav { margin: 0px auto; padding: 0px 10px; width: 62=
0px; }

#top { padding: 8px; }

pre { font-size: 12px; background-color: rgb(239, 239, 239); padding: 4px; =
line-height: 16px; }

figure { margin: 0px; padding: 0px; }

figure.right { float: right; width: 300px; margin-left: 20px; }

figure.left { float: left; width: 300px; margin-right: 20px; }

figcaption { color: rgb(102, 102, 102); font-size: 14px; }

#bottomnav { padding: 8px; }

#bottomnav ul { list-style: none; margin: 0px; padding: 4px 0px 0px; border=
-top: 2px solid black; }

#bottomnav ul li { display: inline; padding-right: 8px; }

#topad { margin: 0px; background-color: rgb(238, 238, 238); padding: 24px; =
font-size: 24px; text-align: center; color: rgb(255, 99, 71); border-bottom=
: 1px solid rgb(174, 189, 204); }

#topad a { color: rgb(0, 0, 238); }
------MultipartBoundary--iaYFYzxq7CY6PurxT9wnbPaGOyp84KrhGc9pyzJE2N------
